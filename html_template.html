<!DOCTYPE html>
<html> 
<head> 
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
  <title>Google Maps MLS Listing Viewer</title> 
  <script src="http://maps.google.com/maps/api/js?key=AIzaSyDbU0DRWKo509knTj58yQEKa7yCFmP3SpQ&libraries=marker" 
          type="text/javascript"></script>
  <style>
  
  .price-tag{
	border-radius: 8px;
	color: #FFFFFF;
	font-size: 14px;
	padding: 4px 8px;
	position: relative;
	transform: translateY(-8px);
  }
  .price-tag::after{
	content: "";
	position: absolute;
	left: 50%;
	top: 100%;
	transform: translate(-50%, 0);
	width: 0;
	height: 0;
	border-left: 6px solid transparent;
	border-right: 6px solid transparent;
  }
  .active-tag {
  background-color: #309600;
}

.active-tag::after {
  border-top: 6px solid #309600;
}
.pending-tag {
  background-color: #3e67cf;
}

.pending-tag::after {
  border-top: 6px solid #3e67cf;
}
.sold-tag {
  background-color: #d33100;
}

.sold-tag::after {
  border-top: 6px solid #d33100;
}
.table-container {
        display: flex;
        flex-direction: column;
		width: 40vw;
    }
#button-hflex {
	display: flex;
	flex-direction: row;
	margin-left: -0.5vw;
	padding-top: 1vh;
	padding-bottom: 1vh;
	margin-top: -1vh;
	background-color: #f0f0f08f;
}
body{
	display: flex;
	flex-direction: row;
	overflow-x: hidden;
}
.list-button{
	vertical-align: middle;
	width: 8vw;
	height: 5vh;
	margin-left: 1vw;
	margin-right: 1vw;
	border: 1px solid #c7c7c7;
	font-family:Helvetica,Arial;
	font-size:14px;
	color: #232323;
	background-color: #ffffff;
	border-radius: 50px;
	padding-left: 1vw;
	padding-right: 1vw;
	padding-top: 0.5vh;
	padding-bottom: 0.5vh;
	font-weight: bold;
}
@keyframes button-clicked{
	from {background-color: #eeeeee; border: 2px solid #818181;}
	to {background-color:rgba(52, 52, 235, 0.3); border: 2px solid #0004ff;}
}

@keyframes button-hovered{
	from {background-color: #ffffff; border: 1px solid #c7c7c7;}
	to {border: 1px solid #818181; background-color: #eeeeee;}
}

@keyframes button-focused{
	from {background-color:rgba(52, 52, 235, 0.3); border: 1px solid #0004ff;}
	to{border: 1px solid #4e53a1; background-color:rgba(101, 101, 224, 0.2);}
}
.list-button.list-button:focus{
	animation-name: button-focused;
	animation-duration: 0.5s;
	border: 1px solid #4e53a1;
	background-color:rgba(101, 101, 224, 0.2);
}
.list-button:hover{
	animation-name: button-hovered;
	animation-duration:0.2s;
	border: 1px solid #818181;
	background-color: #eeeeee;
}

.list-button.list-button:active{
	animation-name: button-clicked;
	animation-duration: 0.3s;
	background-color: rgba(52, 52, 235, 0.3);
	border: 2px solid #1d29d3;
	
}
#header-row{
	background-color: #f0f0f0;
	font-family:Helvetica,Arial;
	font-size: 16px;
	color:#c5a95e;
}
th{
	text-align: left;
	padding-right: 1vw;
	padding-left: 0.1vw;
	padding-top: 0.5vh;
	padding-bottom: 0.5vh;
}
tr{
	font-family: Helvetica, Arial;
	font-size: 12px;
	color:#646464;
}
td{
	padding-top: 0.5vh;
	padding-bottom: 0.5vh;
}
.tr2{
	background-color: #f0f0f0;
}

.addresstd{
	color: #0000EE;
}
.activetd{
	color: #309600;
}
.pendingtd{
	color: #3e67cf;
}
.soldtd{
	color: #d33100;
}
.dot{
	height: 0.5vw;
	width: 0.5vw;
	border-radius: 50px;
	display: inline-block;
	vertical-align: middle;
	margin-right: 0.5vw;
}
.active-dot{
	background-color: #309600;
}
.pending-dot{
	background-color: #3e67cf;
}
.sold-dot{
	background-color: #d33100;
}

</style>
</head> 
<body>
  <div class="table-container">
	<div id="button-hflex"></div>
	<table id="listings-table">
		<tr id="header-row">
			<th style="width: 9vw;">Address</th>
			<th style="width: 3vw;">Status</th>
			<th style="width: 3vw;">DOM</th>
			<th style="width: 4vw;">City</th>
			<th style="width: 13vw">Price</th>
		</tr>
		<tbody></tbody>
	</table>
  </div>
  <div style="position:fixed; top:0; left: 40vw; width:60vw; height:100vh;">
  		<div id="map" style="width: 100%; height: 100%; margin-right: -1vh;"></div>
  </div>

  <script type="text/javascript">
    var locations = [

	];
    var map_markers = [];

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 14,
	  center: new google.maps.LatLng(42.4338, -83.9845),
	  mapTypeId: google.maps.MapTypeId.ROADMAP,
      mapId: "DEMO_MAP_ID"
    });
    
    var infowindow = new google.maps.InfoWindow();

	function formatPrice(p){
		var output = "";
		if (p.indexOf(".") == -1){
			p = p.replace("K", ".0K").replace("M", ".0M");
		}
		output += String(p).replace("K", "000").replace("M", "000000");
		while ((output.length - output.indexOf(".") - 1) % 3 != 0){
			output = output.substring(0, output.length - 1);
		}
		output = output.replace(".", ",")
		if (output.length > 7){
			output = output.slice(0, output.length - 3) + "," + output.slice(output.length - 3);
		}
		return "$" + output;
	}

	function setMapOnClass(map, stat){
		listings_table.innerHTML = initial_table_html;
		for (let i = 0; i < map_markers.length; i++){
			if (map_markers[i][0].content.classList.contains(`${stat}-tag`)){
				map_markers[i][0].setMap(map);
				const price = map_markers[i][1][4];

				const locationRow = listings_table.insertRow();
				if (i % 2 != 0){
				locationRow.className = "tr2";
				}

				for (var j = 0; j < 5; j++){
					const newCell = locationRow.insertCell();
					newCell.textContent = map_markers[i][1][j];
					if (j == 0){
						newCell.className = "addresstd";
					} else if (j == 1){
						newCell.className = `${stat}td`;
						newCell.textContent = String(stat).charAt(0).toUpperCase() + String(stat).slice(1); // Capitalize
					} else if (j == 4){
						let cont = "";
						price_frags = price.split(" - ");
						for (let x = 0; x < price_frags.length; x++){
							cont += formatPrice(price_frags[x]) + " - ";
						}
						cont = cont.substring(0, cont.length - 3);
						newCell.textContent = cont;

					}
				}
			} else{
				map_markers[i][0].setMap(null);
			}
		}
	}
	function setMapOnAll(map){
		listings_table.innerHTML = initial_table_html;
		for (let i = 0; i < map_markers.length; i++){
			const marker = map_markers[i][0];
			const status = map_markers[i][1][1];
			const address = map_markers[i][1][0];
			const price = map_markers[i][1][4];

			marker.setMap(map);
			const locationRow = listings_table.insertRow();
			if (i % 2 != 0){
				locationRow.className = "tr2";
			}
			for (var j = 0; j < 5; j++){
				const newCell = locationRow.insertCell();
				newCell.textContent = map_markers[i][1][j];
				if (j == 0){
					newCell.className = "addresstd";
				} else if (j == 1){
					if (status == "ACT"){
						newCell.className = "activetd";
						newCell.textContent = "Active";
					} else if (status == "PEND"){
						newCell.className = "pendingtd";
						newCell.textContent = "Pending";
					} else if (status == "SOLD"){
						newCell.className = "soldtd";
						newCell.textContent = "Sold";
					} 
				} else if (j == 4){
						let cont = "";
						price_frags = price.split(" - ");
						for (let x = 0; x < price_frags.length; x++){
							cont += formatPrice(price_frags[x]) + " - ";
						}
						cont = cont.substring(0, cont.length - 3);
						newCell.textContent = cont;

				}
			}
		}
		
	}

    var marker, i;
    var buttons = document.getElementById("button-hflex");
	var all_button = document.createElement("button");
	var act_button = document.createElement("button");
	var pend_button = document.createElement("button");
	var sold_button = document.createElement("button");
	var act_count = 0;
	var pend_count = 0;
	var sold_count = 0;
	all_button.classList.add("list-button", "all-button");
	act_button.classList.add("list-button", "active-button");
	pend_button.classList.add("list-button", "pending-button");
	sold_button.classList.add("list-button", "sold-button");

	buttons.appendChild(all_button);
	buttons.appendChild(act_button);
	buttons.appendChild(pend_button);
	buttons.appendChild(sold_button);
	all_button.addEventListener("click", (function() {
		return function() {
			setMapOnAll(map);
		}
	})());
	act_button.addEventListener("click", (function() {
		return function() {
			setMapOnClass(map, "active");
		}
	})());
	pend_button.addEventListener("click", (function() {
		return function() {
			setMapOnClass(map, "pending");
		}
	})());
	sold_button.addEventListener("click", (function() {
		return function() {
			setMapOnClass(map, "sold");
		}
	})());

	var listings_table = document.getElementById("listings-table").tBodies[0];
	const initial_table_html = listings_table.innerHTML;
    for (i = 0; i < locations.length; i++) {  
        const priceTag = document.createElement('div');
		const address = locations[i][0];
		const lat = locations[i][5];
		const long = locations[i][6];
		const price = locations[i][4];
		const status = locations[i][1];

		priceTag.classList.add("price-tag");
        if (status == 'ACT'){
		  act_count++;
          priceTag.classList.add("active-tag");
        } else if (status == 'PEND'){
		  pend_count++;
          priceTag.classList.add("pending-tag");
        } else if (status == 'SOLD'){
		  sold_count++;
          priceTag.classList.add("sold-tag");
        }
        priceTag.textContent = price;
      marker = new google.maps.marker.AdvancedMarkerElement({
        position: new google.maps.LatLng(lat, long),
        map: null,
        content: priceTag
      });
      
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(address);
          infowindow.open(map, marker);
        }
      })(marker, i));
	  map_markers.push([marker, locations[i]]);
    }
	all_button.textContent = `All (${act_count + pend_count + sold_count})`;
	act_button.innerHTML = `<span class="dot active-dot"></span> Active (${act_count})`;
	pend_button.innerHTML = `<span class="dot pending-dot"></span> Pending (${pend_count})`;
	sold_button.innerHTML = `<span class="dot sold-dot"></span> Sold (${sold_count})`;
  </script>
</body>
</html>